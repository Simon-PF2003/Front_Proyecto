<div class="container mt-4 mb-4">
  <!-- Vista de Proveedores -->
  <div *ngIf="currentView === 'suppliers'">
    <div class="row justify-content-center">
      <div class="col-md-10">
        <div class="card">
          <div class="card-header text-center">
            <h2>Seleccionar Proveedor para Orden de Compra</h2>
          </div>
          <div class="card-body">
            <!-- Búsqueda -->
            <div class="row mb-4">
              <div class="col-md-8">
                <label for="searchSupplier" class="form-label">Buscar por CUIT o razón social:</label>
                <input type="text" id="searchSupplier" class="form-control" [(ngModel)]="searchSupplierTerm" 
                       (keyup.enter)="onSearchSupplier()" placeholder="Ingrese CUIT o razón social">
              </div>
              <div class="col-md-4 align-self-end">
                <button class="btn btn-primary w-100" (click)="onSearchSupplier()">
                  <i class="fas fa-search me-2"></i>Buscar
                </button>
              </div>
            </div>

            <!-- Mensaje cuando no hay proveedores -->
            <div *ngIf="suppliers.length === 0" class="alert alert-info text-center">
              <i class="fas fa-info-circle me-2"></i>
              <strong>No se encontraron proveedores.</strong>
            </div>

            <!-- Lista de proveedores -->
            <div class="row" *ngIf="suppliers.length > 0">
              <div class="col-md-6 col-lg-4" *ngFor="let supplier of displayedSuppliers">
                <div class="supplier-card mb-3">
                  <div class="supplier-card-header">
                    <h5 class="mb-0">{{ supplier.businessName }}</h5>
                  </div>
                  <div class="supplier-card-body">
                    <div class="supplier-info-content">
                      <div class="supplier-info-item">
                        <span class="info-label">CUIT:</span>
                        <span class="info-value">{{ supplier.cuit }}</span>
                      </div>
                      <div class="supplier-info-item">
                        <span class="info-label">Dirección:</span>
                        <span class="info-value">{{ supplier.address }}</span>
                      </div>
                      <div class="supplier-info-item">
                        <span class="info-label">Teléfono:</span>
                        <span class="info-value">{{ supplier.phoneNumber }}</span>
                      </div>
                    </div>
                    
                    <div class="mt-3">
                      <button class="btn btn-primary w-100 position-relative" (click)="selectSupplier(supplier)">
                        <i class="fas fa-file-invoice me-2"></i>Generar Orden de Compra
                        <span *ngIf="getLowStockCount(supplier) > 0" 
                              class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-badge-stock">
                          {{ getLowStockCount(supplier) }}
                          <span class="visually-hidden">productos con bajo stock</span>
                        </span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Paginación centrada fuera de la card -->
    <nav class="mt-4" *ngIf="supplierTotalPages > 1">
      <ul class="pagination justify-content-center"> 
        <li class="page-item" [class.disabled]="supplierCurrentPage === 1">
          <button class="page-link" style="background-color: #F8F4EC; border: 1px solid #CCC9C2" 
                  (click)="changeSupplierPage(supplierCurrentPage - 1)">Anterior</button>
        </li>
        <li *ngFor="let page of [].constructor(supplierTotalPages); let i = index" class="page-item">
          <button 
            class="page-link" 
            [ngStyle]="supplierCurrentPage === (i + 1) ? {'background-color': '#4CA7BF', 'border': '1px solid #CCC9C2', 'color': 'white'} : {'background-color': '#F8F4EC', 'border': '1px solid #CCC9C2'}"
            (click)="changeSupplierPage(i + 1)">
            {{ i + 1 }}
          </button>
        </li>
        <li class="page-item" [class.disabled]="supplierCurrentPage === supplierTotalPages">
          <button class="page-link" style="background-color: #F8F4EC; border: 1px solid #CCC9C2;" 
                  (click)="changeSupplierPage(supplierCurrentPage + 1)">Siguiente</button>
        </li>
      </ul>
    </nav>

    <!-- Botón de volver alineado a la derecha de la card -->
    <div class="row justify-content-center mt-3">
      <div class="col-md-10">
        <div class="d-flex justify-content-end">
          <button type="button" class="btn btn-secondary" [routerLink]="'/admin-panel'">
            <i class="fas fa-arrow-left me-2"></i>Volver al Panel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Vista de Productos -->
<div *ngIf="currentView === 'products'" class="container-fluid mt-4">
    <!-- Header con información del proveedor y botón volver -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2>Orden de Compra - {{ selectedSupplier.businessName }}</h2>
          <p class="text-muted mb-0">CUIT: {{ selectedSupplier.cuit }} | Teléfono: {{ selectedSupplier.phoneNumber }}</p>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-secondary" (click)="backToSuppliers()">
            <i class="fas fa-arrow-left me-2"></i>Volver a Proveedores
          </button>
          <button class="btn btn-outline-primary position-relative" (click)="toggleCartVisibility()">
            <i class="fas fa-shopping-cart me-2"></i>
            Carrito
            <span *ngIf="getCartItemsCount() > 0" 
                  class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
              {{ getCartItemsCount() }}
            </span>
          </button>
        </div>
      </div>

      <!-- CARRITO LATERAL -->
      <div *ngIf="isCartVisible" class="cart-sidebar card mb-4" 
           [ngClass]="{'cart-empty': cartItems.length === 0}">
        <div class="card-header d-flex justify-content-between align-items-center" 
             style="background-color: #e3f2fd;">
          <h5 class="mb-0">
            <i class="fas fa-shopping-cart me-2"></i>
            Carrito de Orden
            <span *ngIf="cartItems.length > 0" class="badge bg-primary ms-2">
              {{ cartItems.length }} productos
            </span>
          </h5>
          <div class="d-flex gap-2">
            <button *ngIf="cartItems.length > 0" class="btn btn-sm btn-outline-danger" 
                    (click)="clearCart()">
              <i class="fas fa-trash me-1"></i>Vaciar
            </button>
            <button class="btn-close" (click)="toggleCartVisibility()"></button>
          </div>
        </div>
        
        <div class="card-body">
          <!-- Carrito vacío -->
          <div *ngIf="cartItems.length === 0" class="text-center text-muted py-4">
            <i class="fas fa-shopping-cart fa-3x mb-3 text-muted"></i>
            <p class="mb-0">El carrito está vacío</p>
            <small>Agregue productos usando los botones de "Agregar al carrito"</small>
          </div>
          
          <!-- Items del carrito -->
          <div *ngIf="cartItems.length > 0">
            <div class="cart-item border-bottom pb-2 mb-2" *ngFor="let item of cartItems">
              <div class="row align-items-center">
                <div class="col-8">
                  <h6 class="mb-1">{{ item.desc }}</h6>
                  <small class="text-muted">Código: {{ item.code }}</small>
                </div>
                <div class="col-4">
                  <div class="d-flex align-items-center justify-content-end">
                    <button class="btn btn-sm btn-outline-secondary me-1" 
                            (click)="updateCartQuantity(item._id, item.quantityToBuy - 1)">
                      <i class="fas fa-minus"></i>
                    </button>
                    <input type="number" class="form-control form-control-sm text-center" 
                           style="width: 60px;" min="1"
                           [(ngModel)]="item.quantityToBuy" 
                           (ngModelChange)="updateCartQuantity(item._id, item.quantityToBuy)">
                    <button class="btn btn-sm btn-outline-secondary ms-1" 
                            (click)="updateCartQuantity(item._id, item.quantityToBuy + 1)">
                      <i class="fas fa-plus"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger ms-2" 
                            (click)="removeFromCart(item._id)">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Resumen simple sin precios -->
            <div class="mt-3 pt-2 border-top text-center">
              <div class="text-muted d-flex justify-content-between align-items-center">
                <div>
                  <i class="fas fa-box me-1"></i>
                  {{ cartItems.length }} productos 
                  • {{ getCartItemsCount() }} unidades
                </div>
                <button class="btn btn-primary" (click)="generarOrdenDeCompra()" 
                        [disabled]="cartItems.length === 0">
                  <i class="fas fa-file-invoice me-2"></i>
                  Generar Orden de Compra
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Botón de filtros para móvil -->
      <div class="d-lg-none d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Filtros</h5>
        <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#filtersOffcanvas">
          <i class="fas fa-filter me-2"></i>Filtros
        </button>
      </div>

      <div class="row">
        <!-- SIDEBAR DE FILTROS (desktop) -->
        <aside class="col-lg-3 d-none d-lg-block mb-4">
          <div class="filters-sidebar card sticky-top" style="top: 1rem;">
            <div class="card-header d-flex justify-content-between align-items-center" style="background-color: #F8F4EC;">
              <span><i class="fas fa-sliders-h me-2"></i>Filtros</span>
              <button type="button" class="btn btn-sm btn-outline-secondary" (click)="clearAllFilters()">
                <i class="fas fa-times me-1"></i>Resetear
              </button>
            </div>

            <div class="card-body">
              <div class="accordion" id="filtersAccordion">

                <!-- Precio -->
                <div class="accordion-item">
                  <h2 class="accordion-header" id="headingPrice">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePrice">
                      <i class="fas fa-dollar-sign me-2"></i>Rango de Precio (venta)
                    </button>
                  </h2>
                  <div id="collapsePrice" class="accordion-collapse collapse">
                    <div class="accordion-body">
                      <div class="input-group mb-2">
                        <span class="input-group-text">$</span>
                        <input type="number" class="form-control" placeholder="Mínimo"
                              [(ngModel)]="minPrice" (keydown.enter)="applyPriceFilter()" min="0">
                      </div>
                      <div class="input-group mb-2">
                        <span class="input-group-text">$</span>
                        <input type="number" class="form-control" placeholder="Máximo"
                              [(ngModel)]="maxPrice" (keydown.enter)="applyPriceFilter()" min="0">
                      </div>
                      <div class="d-grid">
                        <button type="button" class="btn btn-soft-primary btn-sm" (click)="applyPriceFilter()">
                          <i class="fas fa-search me-1"></i>Aplicar filtro
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Categoría -->
                <div class="accordion-item">
                  <h2 class="accordion-header" id="headingCategory">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCategory">
                      <i class="fas fa-layer-group me-2"></i>Categoría
                    </button>
                  </h2>
                  <div id="collapseCategory" class="accordion-collapse collapse">
                    <div class="accordion-body">
                      <div class="elegant-select-list" role="listbox">
                        <button type="button" class="elegant-option"
                          *ngFor="let c of categories"
                          [class.active]="selectedCategories.includes(c._id)"
                          (click)="toggleCategoryItem(c._id)">
                          <span>{{ c.type }}</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Marca -->
                <div class="accordion-item">
                  <h2 class="accordion-header" id="headingBrand">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBrand">
                      <i class="fas fa-tag me-2"></i>Marca
                    </button>
                  </h2>
                  <div id="collapseBrand" class="accordion-collapse collapse">
                    <div class="accordion-body">
                      <div class="elegant-select-list" role="listbox">
                        <button type="button" class="elegant-option"
                          *ngFor="let b of brands"
                          [class.active]="selectedBrands.includes(b.brand)"
                          (click)="toggleBrandItem(b.brand)">
                          <span>{{ b.brand }}</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Stock -->
                <div class="accordion-item">
                  <h2 class="accordion-header" id="headingStock">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseStock">
                      <i class="fas fa-boxes me-2"></i>Filtro de Stock
                    </button>
                  </h2>
                  <div id="collapseStock" class="accordion-collapse collapse">
                    <div class="accordion-body">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="lowStockFilter"
                               [(ngModel)]="hasStockFilter" (change)="onLowStockFilterChange()">
                        <label class="form-check-label" for="lowStockFilter">
                          <i class="fas fa-exclamation-triangle me-2"></i>Solo stock bajo
                        </label>
                      </div>
                      <div class="form-check mt-2">
                        <input class="form-check-input" type="checkbox" id="noStockFilter"
                               [(ngModel)]="noStockFilter" (change)="onNoStockFilterChange()">
                        <label class="form-check-label" for="noStockFilter">
                          <i class="fas fa-times-circle me-2"></i>Solo sin stock
                        </label>
                      </div>
                    </div>
                  </div>
                </div>              
              </div>
            </div>
          </div>
        </aside>

        <!-- CONTENIDO PRINCIPAL -->
        <main class="col-lg-9">
          <!-- Barra de estado + orden -->
          <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-2">
            <div class="small text-muted">
              Mostrando {{ displayedProducts.length || 0 }} productos
            </div>
            <div class="d-flex align-items-center gap-2">
              <label for="sortOrder" class="me-1 small text-nowrap">
                <i class="fas fa-sort me-1"></i>Ordenar:
              </label>
              <select id="sortOrder" class="form-select form-select-sm elegant-select" style="min-width: 200px"
                      [(ngModel)]="sortOrder" (change)="sortProducts()">
                <option value="none">Sin orden</option>
                <option value="asc">Precio (venta): Menor a Mayor</option>
                <option value="desc">Precio (venta): Mayor a Menor</option>
                <option value="name-asc">Nombre: A-Z</option>
                <option value="name-desc">Nombre: Z-A</option>
                <option value="stock-asc">Stock: Menor a Mayor</option>
                <option value="stock-desc">Stock: Mayor a Menor</option>
              </select>
            </div>
          </div>

          <!-- Chips de filtros activos -->
          <div class="mb-3 d-flex flex-wrap gap-2">
            <!-- Categorías (multi) -->
            <span *ngFor="let catId of selectedCategories" class="filter-chip">
              Categoría: {{ getCategoryName(catId) }}
              <button type="button" class="btn-close btn-close-white btn-close-sm ms-2"
                      (click)="toggleCategory(catId, false)"></button>
            </span>

            <!-- Marcas (multi) -->
            <span *ngFor="let brand of selectedBrands" class="filter-chip">
              Marca: {{ brand }}
              <button type="button" class="btn-close btn-close-white btn-close-sm ms-2"
                      (click)="toggleBrand(brand, false)"></button>
            </span>

            <!-- Precio -->
            <span *ngIf="minPrice !== null || maxPrice !== null" class="filter-chip">
              Precio (venta): {{ (minPrice || 0) | currency }} - {{ maxPrice !== null ? (maxPrice | currency) : '∞' }}
              <button type="button" class="btn-close btn-close-white btn-close-sm ms-2"
                      (click)="minPrice=null; maxPrice=null; applyPriceFilter()"></button>
            </span>

            <!-- Stock -->
            <span *ngIf="hasStockFilter" class="filter-chip">
              Solo stock bajo
              <button type="button" class="btn-close btn-close-white btn-close-sm ms-2"
                      (click)="hasStockFilter=false; applyAllFilters()"></button>
            </span>

            <span *ngIf="noStockFilter" class="filter-chip">
              Solo sin stock
              <button type="button" class="btn-close btn-close-white btn-close-sm ms-2"
                      (click)="noStockFilter=false; applyAllFilters()"></button>
            </span>

            <!-- Reset si hay cualquier filtro activo -->
            <button *ngIf="selectedCategories.length || selectedBrands.length || minPrice !== null || maxPrice !== null || hasStockFilter || noStockFilter"
                    class="btn btn-sm btn-outline-secondary" (click)="clearAllFilters()">
              <i class="fas fa-times me-1"></i>Resetear todos
            </button>
          </div>

        <!-- Sin resultados -->
        <div *ngIf="products.length === 0" class="alert alert-info text-center">
          <i class="fas fa-info-circle me-2"></i>
          <strong>No hay productos disponibles</strong>
          <p class="mb-0 mt-2">
            <small>El proveedor "{{ selectedSupplier.businessName }}" no tiene productos que cumplan con los filtros aplicados.</small>
          </p>
          <button type="button" class="btn btn-outline-primary btn-sm mt-2" (click)="clearAllFilters()">
            <i class="fas fa-times me-1"></i>Limpiar filtros
          </button>
        </div>

        <!-- GRID de productos -->
        <div class="row" *ngIf="displayedProducts.length > 0">
          <div class="col-md-6 col-lg-4 col-xl-3 mt-4" *ngFor="let product of displayedProducts">
            <div class="product-card" 
                 [ngClass]="{
                   'low-stock': product.isLowStock && !product.isNoStock, 
                   'no-stock': product.isNoStock,
                   'in-cart': product.inCart
                 }">
              <div class="card h-100">
                <div class="position-relative">
                  <img class="card-img-top" [src]="'http://localhost:3000/' + product.image" alt="{{ product.desc }}">
                  
                  <!-- Badge de stock bajo -->
                  <div *ngIf="product.isLowStock && !product.isNoStock" class="position-absolute top-0 start-0 m-2">
                    <span class="badge bg-warning text-dark">
                      <i class="fas fa-exclamation-triangle me-1"></i>Stock Bajo
                    </span>
                  </div>
                  
                  <!-- Badge de sin stock -->
                  <div *ngIf="product.isNoStock" class="position-absolute top-0 start-0 m-2">
                    <span class="badge bg-danger text-white">
                      <i class="fas fa-exclamation-triangle me-1"></i>Sin Stock
                    </span>
                  </div>
                  
                  <!-- Badge de en carrito -->
                  <div *ngIf="product.inCart" class="position-absolute top-0 end-0 m-2">
                    <span class="badge bg-success text-white">
                      <i class="fas fa-check-circle me-1"></i>En Carrito ({{ getProductCartQuantity(product._id) }})
                    </span>
                  </div>
                </div>
                
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title truncate">{{ product.desc }}</h5>
                  <p class="card-text truncate">Código: {{ product.code }}</p>
                  <p class="card-text truncate">Marca: {{ product.brand?.brand || 'Sin marca' }}</p>
                  <p class="card-text truncate">Categoría: {{ product.cat?.type || '' }}</p>
                  
                  <!-- Stock con colores -->
                  <p class="card-text d-flex justify-content-between" [ngClass]="product.isNoStock ? 'text-danger' : (product.isLowStock ? 'text-warning' : '')">
                    <span>
                      <i class="fas fa-boxes me-1"></i>Stock: {{ product.stock }}
                    </span>
                    <span class="small text-muted">
                      (Mín: {{ product.stockMin }})
                    </span>
                  </p>

                  <div class="mt-auto">
                    <p class="card-price mb-3">Precio (venta): {{ product.price | currency }}</p>

                    <!-- Sistema de carrito mejorado -->
                    <div *ngIf="!product.inCart" class="cart-controls">
                      <div class="input-group mb-2">
                        <input type="number" class="form-control" 
                               [(ngModel)]="product.tempQuantity" 
                               min="1" max="999" placeholder="Cantidad">
                        <button class="btn btn-primary" 
                                [disabled]="!product.tempQuantity || product.tempQuantity <= 0"
                                (click)="addToCart(product, product.tempQuantity)">
                          <i class="fas fa-cart-plus me-1"></i>Agregar
                        </button>
                      </div>
                    </div>
                    
                    <!-- Controles cuando está en carrito -->
                    <div *ngIf="product.inCart" class="cart-controls-active">
                      <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="small text-success fw-bold">
                          <i class="fas fa-check-circle me-1"></i>En carrito: {{ getProductCartQuantity(product._id) }}
                        </span>
                        <button class="btn btn-sm btn-outline-danger" 
                                (click)="removeFromCart(product._id)">
                          <i class="fas fa-trash"></i>
                        </button>
                      </div>
                      
                      <div class="input-group input-group-sm">
                        <button class="btn btn-outline-secondary" 
                                (click)="updateCartQuantity(product._id, getProductCartQuantity(product._id) - 1)">
                          <i class="fas fa-minus"></i>
                        </button>
                        <span class="form-control text-center">{{ getProductCartQuantity(product._id) }}</span>
                        <button class="btn btn-outline-secondary" 
                                (click)="updateCartQuantity(product._id, getProductCartQuantity(product._id) + 1)">
                          <i class="fas fa-plus"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Paginación -->
        <nav class="mt-4" *ngIf="totalPages > 1">
          <ul class="pagination justify-content-center">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button class="page-link" style="background-color: #F8F4EC; border: 1px solid #CCC9C2" 
                      (click)="changePage(currentPage - 1)">Anterior</button>
            </li>
            <li *ngFor="let page of [].constructor(totalPages); let i = index" class="page-item">
              <button class="page-link"
                      [ngStyle]="currentPage === (i + 1) ? {'background-color': '#4CA7BF', 'border': '1px solid #CCC9C2', 'color': 'white'} : {'background-color': '#F8F4EC', 'border': '1px solid #CCC9C2'}"
                      (click)="changePage(i + 1)">{{ i + 1 }}</button>
            </li>
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button class="page-link" style="background-color: #F8F4EC; border: 1px solid #CCC9C2;" 
                      (click)="changePage(currentPage + 1)">Siguiente</button>
            </li>
          </ul>
        </nav>
      </main>
    </div>

    <!-- OFFCANVAS (mobile) -->
    <div class="offcanvas offcanvas-end" tabindex="-1" id="filtersOffcanvas">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title"><i class="fas fa-sliders-h me-2"></i>Filtros</h5>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-secondary btn-sm" (click)="clearAllFilters()">
            <i class="fas fa-times me-1"></i>Resetear
          </button>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
      </div>
      <div class="offcanvas-body">

        <!-- Acordeones MOBILE (IDs propios para evitar conflictos) -->
        <div class="accordion" id="filtersAccordionMobile">

          <!-- Precio (mobile) -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingPriceMobile">
              <button class="accordion-button collapsed" type="button"
                      data-bs-toggle="collapse" data-bs-target="#collapsePriceMobile"
                      aria-expanded="false" aria-controls="collapsePriceMobile">
                <i class="fas fa-dollar-sign me-2"></i>Rango de Precio (venta)
              </button>
            </h2>
            <div id="collapsePriceMobile" class="accordion-collapse collapse" aria-labelledby="headingPriceMobile">
              <div class="accordion-body">
                <div class="input-group mb-2">
                  <span class="input-group-text">$</span>
                  <input type="number" class="form-control" placeholder="Mínimo"
                        [(ngModel)]="minPrice" (keydown.enter)="applyPriceFilter()" min="0">
                </div>
                <div class="input-group mb-2">
                  <span class="input-group-text">$</span>
                  <input type="number" class="form-control" placeholder="Máximo"
                        [(ngModel)]="maxPrice" (keydown.enter)="applyPriceFilter()" min="0">
                </div>
                <div class="d-grid">
                  <button type="button" class="btn btn-soft-primary btn-sm" (click)="applyPriceFilter()">
                    <i class="fas fa-search me-1"></i>Aplicar filtro
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Categoría (mobile) -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingCategoryMobile">
              <button class="accordion-button collapsed" type="button"
                      data-bs-toggle="collapse" data-bs-target="#collapseCategoryMobile"
                      aria-expanded="false" aria-controls="collapseCategoryMobile">
                <i class="fas fa-layer-group me-2"></i>Categoría
              </button>
            </h2>
            <div id="collapseCategoryMobile" class="accordion-collapse collapse" aria-labelledby="headingCategoryMobile">
              <div class="accordion-body">
                <div class="elegant-select-list" role="listbox" aria-label="Categorías">
                  <button type="button"
                          class="elegant-option"
                          *ngFor="let c of categories"
                          [class.active]="selectedCategories.includes(c._id)"
                          (click)="toggleCategoryItem(c._id)"
                          role="option"
                          [attr.aria-selected]="selectedCategories.includes(c._id)">
                    <span>{{ c.type }}</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Marca (mobile) -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingBrandMobile">
              <button class="accordion-button collapsed" type="button"
                      data-bs-toggle="collapse" data-bs-target="#collapseBrandMobile"
                      aria-expanded="false" aria-controls="collapseBrandMobile">
                <i class="fas fa-tag me-2"></i>Marca
              </button>
            </h2>
            <div id="collapseBrandMobile" class="accordion-collapse collapse" aria-labelledby="headingBrandMobile">
              <div class="accordion-body">
                <div class="elegant-select-list" role="listbox" aria-label="Marcas">
                  <button type="button"
                          class="elegant-option"
                          *ngFor="let b of brands"
                          [class.active]="selectedBrands.includes(b.brand)"
                          (click)="toggleBrandItem(b.brand)"
                          role="option"
                          [attr.aria-selected]="selectedBrands.includes(b.brand)">
                    <span>{{ b.brand }}</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Stock (mobile) -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingStockMobile">
              <button class="accordion-button collapsed" type="button"
                      data-bs-toggle="collapse" data-bs-target="#collapseStockMobile"
                      aria-expanded="false" aria-controls="collapseStockMobile">
                <i class="fas fa-boxes me-2"></i>Filtro de Stock
              </button>
            </h2>
            <div id="collapseStockMobile" class="accordion-collapse collapse" aria-labelledby="headingStockMobile">
              <div class="accordion-body">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="lowStockFilterMobile"
                         [(ngModel)]="hasStockFilter" (change)="onLowStockFilterChange()">
                  <label class="form-check-label" for="lowStockFilterMobile">
                    <i class="fas fa-exclamation-triangle me-2"></i>Solo stock bajo
                  </label>
                </div>
                <div class="form-check mt-2">
                  <input class="form-check-input" type="checkbox" id="noStockFilterMobile"
                         [(ngModel)]="noStockFilter" (change)="onNoStockFilterChange()">
                  <label class="form-check-label" for="noStockFilterMobile">
                    <i class="fas fa-times-circle me-2"></i>Solo sin stock
                  </label>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
</div>
