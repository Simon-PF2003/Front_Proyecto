<!--<div class="modal-dialog" role="document">-->
<div class="modal-content">
  <div class="modal-header">
    <h5 class="modal-title" id="editProductModalLabel">Editar Producto</h5>
  </div>
  <div class="modal-body">
    <form *ngIf="editedProduct">
      <div class="form-group">
        <label for="productName">Descripcion del Producto</label>
        <input type="text" class="form-control" id="productName" [(ngModel)]="editedProduct.desc" name="name" autocomplete="name">
      </div>
      <div class="form-group">
        <label for="productBrand">Marca:</label>
        <select class="form-control" id="productBrand" [(ngModel)]="editedProduct.brand" name="brand">
          <option value="">Sin marca</option>
          <option *ngFor="let brand of brands" [value]="brand.brand">{{ brand.brand }}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="productPrice">Precio del Producto</label>
        <input type="number" class="form-control" id="productPrice" [(ngModel)]="editedProduct.price" name="price">
      </div>
      <div class="form-group">
        <label for="productStock">Stock</label>
        <input type="number" class="form-control" id="productStock" [(ngModel)]="editedProduct.stock" name="stock">
      </div>
      <div class="form-group">
        <label for="productMinStock">Stock Mínimo</label>
        <input type="number" class="form-control" id="productMinStock" [(ngModel)]="editedProduct.stockMin"
          name="stockMin">
      </div>
      <div class="form-group">
        <label for="productCat">Categoría:</label>
        <select class="form-control" id="productCat" [(ngModel)]="editedProduct.cat" name="categoria" (ngModelChange)="onCategoryChange()">
          <option disabled selected value="">Seleccione una categoría</option>
            <option *ngFor="let category of categories" [value]="category._id">{{ category.type }}</option>
        </select>
      </div>

      <!-- Sección de atributos dinámicos -->
      <div *ngIf="selectedCategory && selectedCategory.attributes && selectedCategory.attributes.length > 0" class="card mb-3 mt-3">
        <div class="card-header">
          <h6 class="mb-0">Características Específicas (opcionales)</h6>
          <small class="text-muted">Información adicional para productos de tipo "{{ selectedCategory.type }}"</small>
        </div>
        <div class="card-body">
          <div *ngFor="let attr of selectedCategory.attributes" class="form-group mb-3">
            <label [for]="'attr-' + attr.key">
              {{ attr.label }}
              <span *ngIf="attr.unit" class="text-muted">({{ attr.unit }})</span>
            </label>
            
            <!-- Campo de texto -->
            <input *ngIf="attr.type === 'string'" 
                   type="text" 
                   class="form-control" 
                   [id]="'attr-' + attr.key"
                   [(ngModel)]="editedProduct.categoryAttributes[attr.key]" 
                   [name]="'attr-' + attr.key"
                   [placeholder]="attr.description || 'Ingrese ' + attr.label.toLowerCase()">
            
            <!-- Campo numérico -->
            <input *ngIf="attr.type === 'number'" 
                   type="number" 
                   class="form-control" 
                   [id]="'attr-' + attr.key"
                   [(ngModel)]="editedProduct.categoryAttributes[attr.key]" 
                   [name]="'attr-' + attr.key"
                   [min]="attr.min || null"
                   [max]="attr.max || null"
                   [placeholder]="attr.description || 'Ingrese ' + attr.label.toLowerCase()">
            
            <!-- Campo booleano -->
            <div *ngIf="attr.type === 'boolean'" class="form-check">
              <input class="form-check-input" 
                     type="checkbox" 
                     [id]="'attr-' + attr.key"
                     [(ngModel)]="editedProduct.categoryAttributes[attr.key]" 
                     [name]="'attr-' + attr.key">
              <label class="form-check-label" [for]="'attr-' + attr.key">
                {{ attr.description || attr.label }}
              </label>
            </div>
            
            <!-- Campo de fecha -->
            <input *ngIf="attr.type === 'date'" 
                   type="date" 
                   class="form-control" 
                   [id]="'attr-' + attr.key"
                   [(ngModel)]="editedProduct.categoryAttributes[attr.key]" 
                   [name]="'attr-' + attr.key">
            
            <small *ngIf="attr.description && attr.type !== 'boolean'" class="form-text text-muted">
              {{ attr.description }}
            </small>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="supplier">Proveedores:</label>
        <div class="dropdown-container">
          <div class="dropdown-header" (click)="toggleDropdown()">
            <span class="dropdown-text">
              <span *ngIf="!editedProduct.suppliers || editedProduct.suppliers.length === 0" class="placeholder-text">Seleccionar proveedores...</span>
              <span *ngIf="editedProduct.suppliers && editedProduct.suppliers.length === 1">{{ editedProduct.suppliers.length }} proveedor seleccionado</span>
              <span *ngIf="editedProduct.suppliers && editedProduct.suppliers.length > 1">{{ editedProduct.suppliers.length }} proveedores seleccionados</span>
            </span>
            <span class="dropdown-arrow" [class.rotated]="isDropdownOpen">▼</span>
          </div>
          
          <div class="dropdown-menu" [class.show]="isDropdownOpen">
            <!-- Acciones rápidas -->
            <div class="dropdown-actions" *ngIf="suppliers.length > 0">
              <button type="button" class="action-btn" (click)="selectAllSuppliers()">
                Seleccionar todos
              </button>
              <button type="button" class="action-btn" (click)="clearAllSuppliers()" 
                      [disabled]="!editedProduct.suppliers || editedProduct.suppliers.length === 0">
                Limpiar selección
              </button>
            </div>
            
            <div class="dropdown-item" *ngFor="let supplier of suppliers">
              <input 
                type="checkbox" 
                [id]="'supplier-' + supplier._id" 
                [checked]="isSupplierSelected(supplier.businessName)"
                (change)="onSupplierToggle(supplier.businessName, $event)">
              <label [for]="'supplier-' + supplier._id" class="checkbox-label">
                {{ supplier.businessName }} 
              </label>
            </div>
            
            <div *ngIf="suppliers.length === 0" class="dropdown-item text-muted">
              No hay proveedores disponibles
            </div>
          </div>
        </div>
        
        <!-- Vista previa de proveedores seleccionados -->
        <div *ngIf="editedProduct.suppliers && editedProduct.suppliers.length > 0" class="selected-suppliers">
          <small class="text-muted">Proveedores seleccionados:</small>
          <div class="suppliers-tags">
            <span *ngFor="let supplier of editedProduct.suppliers" class="supplier-tag">
              {{ supplier }}
              <button type="button" class="tag-remove" (click)="removeSupplier(supplier)">×</button>
            </span>
          </div>
        </div>
      </div>
      <div class="form-group mb-3">
        <label for="image">Imagen del Producto:</label>
        <input type="file" class="form-control-file" id="image" name="image" accept="image/*" (change)="onImageSelected($event)">
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="featured" [(ngModel)]="editedProduct.featured"
          name="featured">
        <label class="form-check-label" for="featured" style="font-size: 1.2em; margin-left: 8px;">Destacar
          producto</label>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="close()">Cerrar</button>
    <button type="button" class="btn btn-primary" (click)="saveChanges()">Guardar Cambios</button>
  </div>
</div>